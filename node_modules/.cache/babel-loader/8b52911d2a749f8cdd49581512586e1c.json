{"ast":null,"code":"import \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport API from \"@/utils/request\";\nvar url = \"/api/book\";\nexport default {\n  name: \"BookInfo\",\n  data: function data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      book: {\n        discount: \"1\"\n      },\n      standards: [],\n      index: 0,\n      standard: {},\n      fileList: [],\n      dialogFormVisible: false,\n      categoryItems: [],\n      checkedCategory: {}\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.request.get(\"/api/category\").then(function (res) {\n      if (res.code === \"200\") {\n        _this.categoryItems = res.data;\n      }\n\n      if (_this.$route.query.book) {\n        _this.book = JSON.parse(_this.$route.query.book);\n        _this.fileList = [{\n          name: \"原始图片\",\n          url: _this.book.imgs\n        }];\n        _this.checkedCategory = _this.categoryItems[_this.book.categoryId]; //从服务器获取商品规格信息\n\n        _this.request.get(url + \"/standard/\" + _this.book.id).then(function (res) {\n          if (res.code === \"200\") {\n            var standards = JSON.parse(res.data);\n            _this.standards = standards;\n          } else {//没有规格\n          }\n        });\n      }\n    });\n  },\n  methods: {\n    /*\r\n    规格操作\r\n     */\n    editStandard: function editStandard(index) {\n      this.standard = this.standards[index];\n      this.index = index;\n      this.dialogFormVisible = true;\n    },\n    addStandard: function addStandard() {\n      this.standard = {};\n      this.index = this.standards.length;\n      this.dialogFormVisible = true;\n    },\n    saveStandard: function saveStandard() {\n      if (this.standard.value == undefined || this.standard.value == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入规格名称\",\n          showClose: true\n        });\n        return;\n      }\n\n      if (this.standard.price == undefined || this.standard.price == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入价格\",\n          showClose: true\n        });\n        return;\n      }\n\n      if (this.standard.store == undefined || this.standard.store == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入库存\",\n          showClose: true\n        });\n        return;\n      }\n\n      this.standards[this.index] = this.standard;\n      this.dialogFormVisible = false;\n    },\n    handleClose: function handleClose(standard) {\n      this.standards.splice(this.standards.indexOf(standard), 1);\n    },\n\n    /*\r\n    文件上传操作\r\n     */\n    handleImgSuccess: function handleImgSuccess(res) {\n      this.book.imgs = res.data;\n      this.save();\n    },\n    handleChange: function handleChange(file, fileList) {\n      this.fileList = fileList.slice(-3);\n    },\n    handleRemove: function handleRemove() {\n      this.fileList.pop();\n    },\n\n    /*\r\n    保存数据操作\r\n     */\n    //点击提交按钮\n    submit: function submit() {\n      if (this.book.name == undefined || this.book.name.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品名称\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.book.description == undefined || this.book.description.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品描述\",\n          showClose: true\n        });\n        return false;\n      } // if (this.standards.length === 0) {\n      //   this.$message({\n      //     type: \"error\",\n      //     message: \"请至少添加一个规格\",\n      //     showClose: true,\n      //   });\n      //   return false;\n      // }\n\n\n      if (this.book.discount == undefined || this.book.discount === \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品折扣\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.book.categoryId == undefined) {\n        this.$message({\n          type: \"error\",\n          message: \"请选择商品分类\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.fileList.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请上传图片\",\n          showClose: true\n        });\n        return false;\n      } // 先上传图片再保存数据\n\n\n      if (this.fileList[0].status === \"ready\") {\n        this.$refs.upload.submit();\n      } else if (this.fileList[0].status === \"success\") {\n        //没有修改初始的图片。直接保存数据\n        this.save();\n      }\n    },\n    //保存数据\n    save: function save() {\n      var _this2 = this;\n\n      API.post(url, this.book).then(function (res2) {\n        if (res2.code === \"200\") {\n          _this2.book.id = res2.data;\n\n          _this2.request.post(url + \"/standard?bookId=\" + _this2.book.id, _this2.standards).then(function (res) {\n            if (res.code === \"200\") {\n              _this2.$message({\n                type: \"success\",\n                message: \"操作成功\",\n                showClose: true\n              });\n\n              _this2.$router.go(-1);\n            } else {\n              _this2.$message({\n                type: \"error\",\n                message: \"操作失败\",\n                showClose: true\n              });\n            }\n          });\n        } else {\n          _this2.$message({\n            type: \"error\",\n            message: res2.msg\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiHA;AACA;AACA;AACAA,kBADA;AAEAC,MAFA,kBAEA;AACA;AACAC,wCADA;AAEAC;AACAC;AADA,OAFA;AAKAC,mBALA;AAMAC,cANA;AAOAC,kBAPA;AAQAC,kBARA;AASAC,8BATA;AAUAC,uBAVA;AAWAC;AAXA;AAaA,GAhBA;AAiBAC,SAjBA,qBAiBA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AAAAZ;AAAAa;AAAA;AACA,2EAHA,CAIA;;AACA;AACA;AACA;AACA;AACA,WAHA,MAGA,CACA;AACA;AACA,SAPA;AAQA;AACA,KAlBA;AAmBA,GArCA;AAsCAC;AACA;AACA;AACA;AACAC,gBAJA,wBAIAT,KAJA,EAIA;AACA;AACA;AACA;AACA,KARA;AASAU,eATA,yBASA;AACA;AACA;AACA;AACA,KAbA;AAiBAC,gBAjBA,0BAiBA;AACA;AAEA;AACAC,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACA,KA7CA;AA8CAC,eA9CA,uBA8CAd,QA9CA,EA8CA;AACA;AACA,KAhDA;;AAiDA;AACA;AACA;AACAe,oBApDA,4BAoDAC,GApDA,EAoDA;AACA;AACA;AACA,KAvDA;AAwDAC,gBAxDA,wBAwDAC,IAxDA,EAwDAjB,QAxDA,EAwDA;AACA;AACA,KA1DA;AA2DAkB,gBA3DA,0BA2DA;AACA;AACA,KA7DA;;AA8DA;AACA;AACA;AACA;AACAC,UAlEA,oBAkEA;AACA;AACA;AACAT,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA,UACA,sCACA,kCAFA,EAGA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA,OAnBA,CAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA,UACA,iCADA,EAEA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA,OArDA,CAsDA;;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA,KA/HA;AAgIA;AACAQ,QAjIA,kBAiIA;AAAA;;AACAC;AACA;AACA;;AACA,yBACAC,IADA,CACAjB,0CADA,EACA,gBADA,EAEAkB,IAFA,CAEA;AACA;AACA;AACAb,+BADA;AAEAC,+BAFA;AAGAC;AAHA;;AAKA;AACA,aAPA,MAOA;AACA;AACAF,6BADA;AAEAC,+BAFA;AAGAC;AAHA;AAKA;AACA,WAjBA;AAkBA,SApBA,MAoBA;AACA;AACAF,yBADA;AAEAC;AAFA;AAIA;AACA,OA3BA;AA4BA;AA9JA;AAtCA","names":["name","data","baseApi","book","discount","standards","index","standard","fileList","dialogFormVisible","categoryItems","checkedCategory","created","url","methods","editStandard","addStandard","saveStandard","type","message","showClose","handleClose","handleImgSuccess","res","handleChange","file","handleRemove","submit","save","API","post","then"],"sourceRoot":"src/views/manage/book","sources":["BookInfo.vue"],"sourcesContent":["<template>\r\n  <div style=\"width: 1000px; margin: 50px auto\">\r\n    <el-form :model=\"book\">\r\n      <el-form-item label=\"商品名称\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"book.name\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品描述\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"book.description\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"规格\" label-width=\"150px\">\r\n        <el-tag\r\n          closable\r\n          @close=\"handleClose(standard)\"\r\n          :disable-transitions=\"true\"\r\n          style=\"margin-right: 10px\"\r\n          v-for=\"(standard, index) in standards\"\r\n          :key=\"index\"\r\n          @click=\"editStandard(index)\"\r\n          >{{ standard.value }}</el-tag\r\n        >\r\n        <el-button icon=\"el-icon-plus\" circle @click=\"addStandard\"></el-button>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"折扣\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"book.discount\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"分类\" label-width=\"150px\">\r\n        <el-select v-model=\"book.categoryId\" placeholder=\"请选择\">\r\n          <el-option\r\n            v-for=\"item in categoryItems\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n          >\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品图片\" label-width=\"150px\">\r\n        <el-upload\r\n          class=\"upload-demo\"\r\n          ref=\"upload\"\r\n          :action=\"baseApi + '/file/upload'\"\r\n          :file-list=\"fileList\"\r\n          :on-change=\"handleChange\"\r\n          :limit=\"1\"\r\n          :on-remove=\"handleRemove\"\r\n          :on-success=\"handleImgSuccess\"\r\n          :auto-upload=\"false\"\r\n        >\r\n          <el-button slot=\"trigger\" size=\"small\" type=\"primary\"\r\n            >选取文件</el-button\r\n          >\r\n          <div slot=\"tip\" class=\"el-upload__tip\">\r\n            只能上传一个jpg/png文件，且不超过500kb\r\n          </div>\r\n        </el-upload>\r\n      </el-form-item>\r\n      <el-form-item label-width=\"150px\">\r\n        <el-button type=\"success\" @click=\"submit\">提交</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!-- 弹窗   -->\r\n    <el-dialog\r\n      title=\"规格信息\"\r\n      :visible.sync=\"dialogFormVisible\"\r\n      width=\"30%\"\r\n      :close-on-click-modal=\"false\"\r\n    >\r\n      <el-form :model=\"standard\">\r\n        <el-form-item label=\"规格名称\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.value\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"价格\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.price\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"库存\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.store\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveStandard\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport API from \"@/utils/request\";\r\nconst url = \"/api/book\";\r\nexport default {\r\n  name: \"BookInfo\",\r\n  data() {\r\n    return {\r\n      baseApi: this.$store.state.baseApi,\r\n      book: {\r\n        discount: \"1\",\r\n      },\r\n      standards: [],\r\n      index: 0,\r\n      standard: {},\r\n      fileList: [],\r\n      dialogFormVisible: false,\r\n      categoryItems: [],\r\n      checkedCategory: {},\r\n    };\r\n  },\r\n  created() {\r\n    this.request.get(\"/api/category\").then((res) => {\r\n      if (res.code === \"200\") {\r\n        this.categoryItems = res.data;\r\n      }\r\n      if (this.$route.query.book) {\r\n        this.book = JSON.parse(this.$route.query.book);\r\n        this.fileList = [{ name: \"原始图片\", url: this.book.imgs }];\r\n        this.checkedCategory = this.categoryItems[this.book.categoryId];\r\n        //从服务器获取商品规格信息\r\n        this.request.get(url + \"/standard/\" + this.book.id).then((res) => {\r\n          if (res.code === \"200\") {\r\n            let standards = JSON.parse(res.data);\r\n            this.standards = standards;\r\n          } else {\r\n            //没有规格\r\n          }\r\n        });\r\n      }\r\n    });\r\n  },\r\n  methods: {\r\n    /*\r\n    规格操作\r\n     */\r\n    editStandard(index) {\r\n      this.standard = this.standards[index];\r\n      this.index = index;\r\n      this.dialogFormVisible = true;\r\n    },\r\n    addStandard() {\r\n      this.standard = {};\r\n      this.index = this.standards.length;\r\n      this.dialogFormVisible = true;\r\n    },\r\n\r\n\r\n\r\n    saveStandard() {\r\n      if (this.standard.value == undefined || this.standard.value == \"\") {\r\n        \r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入规格名称\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      if (this.standard.price == undefined || this.standard.price == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入价格\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      if (this.standard.store == undefined || this.standard.store == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入库存\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      this.standards[this.index] = this.standard;\r\n      this.dialogFormVisible = false;\r\n    },\r\n    handleClose(standard) {\r\n      this.standards.splice(this.standards.indexOf(standard), 1);\r\n    },\r\n    /*\r\n    文件上传操作\r\n     */\r\n    handleImgSuccess(res) {\r\n      this.book.imgs = res.data;\r\n      this.save();\r\n    },\r\n    handleChange(file, fileList) {\r\n      this.fileList = fileList.slice(-3);\r\n    },\r\n    handleRemove() {\r\n      this.fileList.pop();\r\n    },\r\n    /*\r\n    保存数据操作\r\n     */\r\n    //点击提交按钮\r\n    submit() {\r\n      if (this.book.name == undefined || this.book.name.trim() == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品名称\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        this.book.description == undefined ||\r\n        this.book.description.trim() == \"\"\r\n      ) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品描述\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      // if (this.standards.length === 0) {\r\n      //   this.$message({\r\n      //     type: \"error\",\r\n      //     message: \"请至少添加一个规格\",\r\n      //     showClose: true,\r\n      //   });\r\n      //   return false;\r\n      // }\r\n      if (this.book.discount == undefined || this.book.discount === \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品折扣\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        this.book.categoryId == undefined\r\n      ) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请选择商品分类\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (this.fileList.length === 0) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请上传图片\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      // 先上传图片再保存数据\r\n      if (this.fileList[0].status === \"ready\") {\r\n        this.$refs.upload.submit();\r\n      } else if (this.fileList[0].status === \"success\") {\r\n        //没有修改初始的图片。直接保存数据\r\n        this.save();\r\n      }\r\n    },\r\n    //保存数据\r\n    save() {\r\n      API.post(url, this.book).then((res2) => {\r\n        if (res2.code === \"200\") {\r\n          this.book.id = res2.data;\r\n          this.request\r\n            .post(url + \"/standard?bookId=\" + this.book.id, this.standards)\r\n            .then((res) => {\r\n              if (res.code === \"200\") {\r\n                this.$message({\r\n                  type: \"success\",\r\n                  message: \"操作成功\",\r\n                  showClose: true,\r\n                });\r\n                this.$router.go(-1);\r\n              } else {\r\n                this.$message({\r\n                  type: \"error\",\r\n                  message: \"操作失败\",\r\n                  showClose: true,\r\n                });\r\n              }\r\n            });\r\n        } else {\r\n          this.$message({\r\n            type: \"error\",\r\n            message: res2.msg,\r\n          });\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>"]},"metadata":{},"sourceType":"module"}