{"ast":null,"code":"import \"core-js/modules/es.array.fill.js\";\n\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\n\n/**\r\n * AUTO-GENERATED FILE. DO NOT MODIFY.\r\n */\n\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\nimport { __extends } from \"tslib\";\nimport * as graphic from '../../util/graphic.js';\nimport { setStatesStylesFromModel, toggleHoverEmphasis } from '../../util/states.js';\nimport ChartView from '../../view/Chart.js';\nimport { setLabelLineStyle, getLabelLineStatesModels } from '../../label/labelGuideHelper.js';\nimport { setLabelStyle, getLabelStatesModels } from '../../label/labelStyle.js';\nimport { saveOldStyle } from '../../animation/basicTrasition.js';\nvar opacityAccessPath = ['itemStyle', 'opacity'];\n/**\r\n * Piece of pie including Sector, Label, LabelLine\r\n */\n\nvar FunnelPiece =\n/** @class */\nfunction (_super) {\n  __extends(FunnelPiece, _super);\n\n  function FunnelPiece(data, idx) {\n    var _this = _super.call(this) || this;\n\n    var polygon = _this;\n    var labelLine = new graphic.Polyline();\n    var text = new graphic.Text();\n    polygon.setTextContent(text);\n\n    _this.setTextGuideLine(labelLine);\n\n    _this.updateData(data, idx, true);\n\n    return _this;\n  }\n\n  FunnelPiece.prototype.updateData = function (data, idx, firstCreate) {\n    var polygon = this;\n    var seriesModel = data.hostModel;\n    var itemModel = data.getItemModel(idx);\n    var layout = data.getItemLayout(idx);\n    var emphasisModel = itemModel.getModel('emphasis');\n    var opacity = itemModel.get(opacityAccessPath);\n    opacity = opacity == null ? 1 : opacity;\n\n    if (!firstCreate) {\n      saveOldStyle(polygon);\n    } // Update common style\n\n\n    polygon.useStyle(data.getItemVisual(idx, 'style'));\n    polygon.style.lineJoin = 'round';\n\n    if (firstCreate) {\n      polygon.setShape({\n        points: layout.points\n      });\n      polygon.style.opacity = 0;\n      graphic.initProps(polygon, {\n        style: {\n          opacity: opacity\n        }\n      }, seriesModel, idx);\n    } else {\n      graphic.updateProps(polygon, {\n        style: {\n          opacity: opacity\n        },\n        shape: {\n          points: layout.points\n        }\n      }, seriesModel, idx);\n    }\n\n    setStatesStylesFromModel(polygon, itemModel);\n\n    this._updateLabel(data, idx);\n\n    toggleHoverEmphasis(this, emphasisModel.get('focus'), emphasisModel.get('blurScope'), emphasisModel.get('disabled'));\n  };\n\n  FunnelPiece.prototype._updateLabel = function (data, idx) {\n    var polygon = this;\n    var labelLine = this.getTextGuideLine();\n    var labelText = polygon.getTextContent();\n    var seriesModel = data.hostModel;\n    var itemModel = data.getItemModel(idx);\n    var layout = data.getItemLayout(idx);\n    var labelLayout = layout.label;\n    var style = data.getItemVisual(idx, 'style');\n    var visualColor = style.fill;\n    setLabelStyle( // position will not be used in setLabelStyle\n    labelText, getLabelStatesModels(itemModel), {\n      labelFetcher: data.hostModel,\n      labelDataIndex: idx,\n      defaultOpacity: style.opacity,\n      defaultText: data.getName(idx)\n    }, {\n      normal: {\n        align: labelLayout.textAlign,\n        verticalAlign: labelLayout.verticalAlign\n      }\n    });\n    polygon.setTextConfig({\n      local: true,\n      inside: !!labelLayout.inside,\n      insideStroke: visualColor,\n      // insideFill: 'auto',\n      outsideFill: visualColor\n    });\n    var linePoints = labelLayout.linePoints;\n    labelLine.setShape({\n      points: linePoints\n    });\n    polygon.textGuideLineConfig = {\n      anchor: linePoints ? new graphic.Point(linePoints[0][0], linePoints[0][1]) : null\n    }; // Make sure update style on labelText after setLabelStyle.\n    // Because setLabelStyle will replace a new style on it.\n\n    graphic.updateProps(labelText, {\n      style: {\n        x: labelLayout.x,\n        y: labelLayout.y\n      }\n    }, seriesModel, idx);\n    labelText.attr({\n      rotation: labelLayout.rotation,\n      originX: labelLayout.x,\n      originY: labelLayout.y,\n      z2: 10\n    });\n    setLabelLineStyle(polygon, getLabelLineStatesModels(itemModel), {\n      // Default use item visual color\n      stroke: visualColor\n    });\n  };\n\n  return FunnelPiece;\n}(graphic.Polygon);\n\nvar FunnelView =\n/** @class */\nfunction (_super) {\n  __extends(FunnelView, _super);\n\n  function FunnelView() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = FunnelView.type;\n    _this.ignoreLabelLineUpdate = true;\n    return _this;\n  }\n\n  FunnelView.prototype.render = function (seriesModel, ecModel, api) {\n    var data = seriesModel.getData();\n    var oldData = this._data;\n    var group = this.group;\n    data.diff(oldData).add(function (idx) {\n      var funnelPiece = new FunnelPiece(data, idx);\n      data.setItemGraphicEl(idx, funnelPiece);\n      group.add(funnelPiece);\n    }).update(function (newIdx, oldIdx) {\n      var piece = oldData.getItemGraphicEl(oldIdx);\n      piece.updateData(data, newIdx);\n      group.add(piece);\n      data.setItemGraphicEl(newIdx, piece);\n    }).remove(function (idx) {\n      var piece = oldData.getItemGraphicEl(idx);\n      graphic.removeElementWithFadeOut(piece, seriesModel, idx);\n    }).execute();\n    this._data = data;\n  };\n\n  FunnelView.prototype.remove = function () {\n    this.group.removeAll();\n    this._data = null;\n  };\n\n  FunnelView.prototype.dispose = function () {};\n\n  FunnelView.type = 'funnel';\n  return FunnelView;\n}(ChartView);\n\nexport default FunnelView;","map":{"version":3,"sources":["D:/Work/WorkSpace/GitWorkSpace/TenShop/resource/ElectronicMall/src/qingge-Market/qingge-vue/node_modules/echarts/lib/chart/funnel/FunnelView.js"],"names":["__extends","graphic","setStatesStylesFromModel","toggleHoverEmphasis","ChartView","setLabelLineStyle","getLabelLineStatesModels","setLabelStyle","getLabelStatesModels","saveOldStyle","opacityAccessPath","FunnelPiece","_super","data","idx","_this","call","polygon","labelLine","Polyline","text","Text","setTextContent","setTextGuideLine","updateData","prototype","firstCreate","seriesModel","hostModel","itemModel","getItemModel","layout","getItemLayout","emphasisModel","getModel","opacity","get","useStyle","getItemVisual","style","lineJoin","setShape","points","initProps","updateProps","shape","_updateLabel","getTextGuideLine","labelText","getTextContent","labelLayout","label","visualColor","fill","labelFetcher","labelDataIndex","defaultOpacity","defaultText","getName","normal","align","textAlign","verticalAlign","setTextConfig","local","inside","insideStroke","outsideFill","linePoints","textGuideLineConfig","anchor","Point","x","y","attr","rotation","originX","originY","z2","stroke","Polygon","FunnelView","apply","arguments","type","ignoreLabelLineUpdate","render","ecModel","api","getData","oldData","_data","group","diff","add","funnelPiece","setItemGraphicEl","update","newIdx","oldIdx","piece","getItemGraphicEl","remove","removeElementWithFadeOut","execute","removeAll","dispose"],"mappings":";;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAO,KAAKC,OAAZ,MAAyB,uBAAzB;AACA,SAASC,wBAAT,EAAmCC,mBAAnC,QAA8D,sBAA9D;AACA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,SAASC,iBAAT,EAA4BC,wBAA5B,QAA4D,iCAA5D;AACA,SAASC,aAAT,EAAwBC,oBAAxB,QAAoD,2BAApD;AACA,SAASC,YAAT,QAA6B,mCAA7B;AACA,IAAIC,iBAAiB,GAAG,CAAC,WAAD,EAAc,SAAd,CAAxB;AACA;AACA;AACA;;AAEA,IAAIC,WAAW;AACf;AACA,UAAUC,MAAV,EAAkB;AAChBZ,EAAAA,SAAS,CAACW,WAAD,EAAcC,MAAd,CAAT;;AAEA,WAASD,WAAT,CAAqBE,IAArB,EAA2BC,GAA3B,EAAgC;AAC9B,QAAIC,KAAK,GAAGH,MAAM,CAACI,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AAEA,QAAIC,OAAO,GAAGF,KAAd;AACA,QAAIG,SAAS,GAAG,IAAIjB,OAAO,CAACkB,QAAZ,EAAhB;AACA,QAAIC,IAAI,GAAG,IAAInB,OAAO,CAACoB,IAAZ,EAAX;AACAJ,IAAAA,OAAO,CAACK,cAAR,CAAuBF,IAAvB;;AAEAL,IAAAA,KAAK,CAACQ,gBAAN,CAAuBL,SAAvB;;AAEAH,IAAAA,KAAK,CAACS,UAAN,CAAiBX,IAAjB,EAAuBC,GAAvB,EAA4B,IAA5B;;AAEA,WAAOC,KAAP;AACD;;AAEDJ,EAAAA,WAAW,CAACc,SAAZ,CAAsBD,UAAtB,GAAmC,UAAUX,IAAV,EAAgBC,GAAhB,EAAqBY,WAArB,EAAkC;AACnE,QAAIT,OAAO,GAAG,IAAd;AACA,QAAIU,WAAW,GAAGd,IAAI,CAACe,SAAvB;AACA,QAAIC,SAAS,GAAGhB,IAAI,CAACiB,YAAL,CAAkBhB,GAAlB,CAAhB;AACA,QAAIiB,MAAM,GAAGlB,IAAI,CAACmB,aAAL,CAAmBlB,GAAnB,CAAb;AACA,QAAImB,aAAa,GAAGJ,SAAS,CAACK,QAAV,CAAmB,UAAnB,CAApB;AACA,QAAIC,OAAO,GAAGN,SAAS,CAACO,GAAV,CAAc1B,iBAAd,CAAd;AACAyB,IAAAA,OAAO,GAAGA,OAAO,IAAI,IAAX,GAAkB,CAAlB,GAAsBA,OAAhC;;AAEA,QAAI,CAACT,WAAL,EAAkB;AAChBjB,MAAAA,YAAY,CAACQ,OAAD,CAAZ;AACD,KAXkE,CAWjE;;;AAGFA,IAAAA,OAAO,CAACoB,QAAR,CAAiBxB,IAAI,CAACyB,aAAL,CAAmBxB,GAAnB,EAAwB,OAAxB,CAAjB;AACAG,IAAAA,OAAO,CAACsB,KAAR,CAAcC,QAAd,GAAyB,OAAzB;;AAEA,QAAId,WAAJ,EAAiB;AACfT,MAAAA,OAAO,CAACwB,QAAR,CAAiB;AACfC,QAAAA,MAAM,EAAEX,MAAM,CAACW;AADA,OAAjB;AAGAzB,MAAAA,OAAO,CAACsB,KAAR,CAAcJ,OAAd,GAAwB,CAAxB;AACAlC,MAAAA,OAAO,CAAC0C,SAAR,CAAkB1B,OAAlB,EAA2B;AACzBsB,QAAAA,KAAK,EAAE;AACLJ,UAAAA,OAAO,EAAEA;AADJ;AADkB,OAA3B,EAIGR,WAJH,EAIgBb,GAJhB;AAKD,KAVD,MAUO;AACLb,MAAAA,OAAO,CAAC2C,WAAR,CAAoB3B,OAApB,EAA6B;AAC3BsB,QAAAA,KAAK,EAAE;AACLJ,UAAAA,OAAO,EAAEA;AADJ,SADoB;AAI3BU,QAAAA,KAAK,EAAE;AACLH,UAAAA,MAAM,EAAEX,MAAM,CAACW;AADV;AAJoB,OAA7B,EAOGf,WAPH,EAOgBb,GAPhB;AAQD;;AAEDZ,IAAAA,wBAAwB,CAACe,OAAD,EAAUY,SAAV,CAAxB;;AAEA,SAAKiB,YAAL,CAAkBjC,IAAlB,EAAwBC,GAAxB;;AAEAX,IAAAA,mBAAmB,CAAC,IAAD,EAAO8B,aAAa,CAACG,GAAd,CAAkB,OAAlB,CAAP,EAAmCH,aAAa,CAACG,GAAd,CAAkB,WAAlB,CAAnC,EAAmEH,aAAa,CAACG,GAAd,CAAkB,UAAlB,CAAnE,CAAnB;AACD,GA3CD;;AA6CAzB,EAAAA,WAAW,CAACc,SAAZ,CAAsBqB,YAAtB,GAAqC,UAAUjC,IAAV,EAAgBC,GAAhB,EAAqB;AACxD,QAAIG,OAAO,GAAG,IAAd;AACA,QAAIC,SAAS,GAAG,KAAK6B,gBAAL,EAAhB;AACA,QAAIC,SAAS,GAAG/B,OAAO,CAACgC,cAAR,EAAhB;AACA,QAAItB,WAAW,GAAGd,IAAI,CAACe,SAAvB;AACA,QAAIC,SAAS,GAAGhB,IAAI,CAACiB,YAAL,CAAkBhB,GAAlB,CAAhB;AACA,QAAIiB,MAAM,GAAGlB,IAAI,CAACmB,aAAL,CAAmBlB,GAAnB,CAAb;AACA,QAAIoC,WAAW,GAAGnB,MAAM,CAACoB,KAAzB;AACA,QAAIZ,KAAK,GAAG1B,IAAI,CAACyB,aAAL,CAAmBxB,GAAnB,EAAwB,OAAxB,CAAZ;AACA,QAAIsC,WAAW,GAAGb,KAAK,CAACc,IAAxB;AACA9C,IAAAA,aAAa,EAAE;AACfyC,IAAAA,SADa,EACFxC,oBAAoB,CAACqB,SAAD,CADlB,EAC+B;AAC1CyB,MAAAA,YAAY,EAAEzC,IAAI,CAACe,SADuB;AAE1C2B,MAAAA,cAAc,EAAEzC,GAF0B;AAG1C0C,MAAAA,cAAc,EAAEjB,KAAK,CAACJ,OAHoB;AAI1CsB,MAAAA,WAAW,EAAE5C,IAAI,CAAC6C,OAAL,CAAa5C,GAAb;AAJ6B,KAD/B,EAMV;AACD6C,MAAAA,MAAM,EAAE;AACNC,QAAAA,KAAK,EAAEV,WAAW,CAACW,SADb;AAENC,QAAAA,aAAa,EAAEZ,WAAW,CAACY;AAFrB;AADP,KANU,CAAb;AAYA7C,IAAAA,OAAO,CAAC8C,aAAR,CAAsB;AACpBC,MAAAA,KAAK,EAAE,IADa;AAEpBC,MAAAA,MAAM,EAAE,CAAC,CAACf,WAAW,CAACe,MAFF;AAGpBC,MAAAA,YAAY,EAAEd,WAHM;AAIpB;AACAe,MAAAA,WAAW,EAAEf;AALO,KAAtB;AAOA,QAAIgB,UAAU,GAAGlB,WAAW,CAACkB,UAA7B;AACAlD,IAAAA,SAAS,CAACuB,QAAV,CAAmB;AACjBC,MAAAA,MAAM,EAAE0B;AADS,KAAnB;AAGAnD,IAAAA,OAAO,CAACoD,mBAAR,GAA8B;AAC5BC,MAAAA,MAAM,EAAEF,UAAU,GAAG,IAAInE,OAAO,CAACsE,KAAZ,CAAkBH,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAAlB,EAAoCA,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAApC,CAAH,GAA2D;AADjD,KAA9B,CAjCwD,CAmCrD;AACH;;AAEAnE,IAAAA,OAAO,CAAC2C,WAAR,CAAoBI,SAApB,EAA+B;AAC7BT,MAAAA,KAAK,EAAE;AACLiC,QAAAA,CAAC,EAAEtB,WAAW,CAACsB,CADV;AAELC,QAAAA,CAAC,EAAEvB,WAAW,CAACuB;AAFV;AADsB,KAA/B,EAKG9C,WALH,EAKgBb,GALhB;AAMAkC,IAAAA,SAAS,CAAC0B,IAAV,CAAe;AACbC,MAAAA,QAAQ,EAAEzB,WAAW,CAACyB,QADT;AAEbC,MAAAA,OAAO,EAAE1B,WAAW,CAACsB,CAFR;AAGbK,MAAAA,OAAO,EAAE3B,WAAW,CAACuB,CAHR;AAIbK,MAAAA,EAAE,EAAE;AAJS,KAAf;AAMAzE,IAAAA,iBAAiB,CAACY,OAAD,EAAUX,wBAAwB,CAACuB,SAAD,CAAlC,EAA+C;AAC9D;AACAkD,MAAAA,MAAM,EAAE3B;AAFsD,KAA/C,CAAjB;AAID,GAtDD;;AAwDA,SAAOzC,WAAP;AACD,CAxHD,CAwHEV,OAAO,CAAC+E,OAxHV,CAFA;;AA4HA,IAAIC,UAAU;AACd;AACA,UAAUrE,MAAV,EAAkB;AAChBZ,EAAAA,SAAS,CAACiF,UAAD,EAAarE,MAAb,CAAT;;AAEA,WAASqE,UAAT,GAAsB;AACpB,QAAIlE,KAAK,GAAGH,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACsE,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAAhE;;AAEApE,IAAAA,KAAK,CAACqE,IAAN,GAAaH,UAAU,CAACG,IAAxB;AACArE,IAAAA,KAAK,CAACsE,qBAAN,GAA8B,IAA9B;AACA,WAAOtE,KAAP;AACD;;AAEDkE,EAAAA,UAAU,CAACxD,SAAX,CAAqB6D,MAArB,GAA8B,UAAU3D,WAAV,EAAuB4D,OAAvB,EAAgCC,GAAhC,EAAqC;AACjE,QAAI3E,IAAI,GAAGc,WAAW,CAAC8D,OAAZ,EAAX;AACA,QAAIC,OAAO,GAAG,KAAKC,KAAnB;AACA,QAAIC,KAAK,GAAG,KAAKA,KAAjB;AACA/E,IAAAA,IAAI,CAACgF,IAAL,CAAUH,OAAV,EAAmBI,GAAnB,CAAuB,UAAUhF,GAAV,EAAe;AACpC,UAAIiF,WAAW,GAAG,IAAIpF,WAAJ,CAAgBE,IAAhB,EAAsBC,GAAtB,CAAlB;AACAD,MAAAA,IAAI,CAACmF,gBAAL,CAAsBlF,GAAtB,EAA2BiF,WAA3B;AACAH,MAAAA,KAAK,CAACE,GAAN,CAAUC,WAAV;AACD,KAJD,EAIGE,MAJH,CAIU,UAAUC,MAAV,EAAkBC,MAAlB,EAA0B;AAClC,UAAIC,KAAK,GAAGV,OAAO,CAACW,gBAAR,CAAyBF,MAAzB,CAAZ;AACAC,MAAAA,KAAK,CAAC5E,UAAN,CAAiBX,IAAjB,EAAuBqF,MAAvB;AACAN,MAAAA,KAAK,CAACE,GAAN,CAAUM,KAAV;AACAvF,MAAAA,IAAI,CAACmF,gBAAL,CAAsBE,MAAtB,EAA8BE,KAA9B;AACD,KATD,EASGE,MATH,CASU,UAAUxF,GAAV,EAAe;AACvB,UAAIsF,KAAK,GAAGV,OAAO,CAACW,gBAAR,CAAyBvF,GAAzB,CAAZ;AACAb,MAAAA,OAAO,CAACsG,wBAAR,CAAiCH,KAAjC,EAAwCzE,WAAxC,EAAqDb,GAArD;AACD,KAZD,EAYG0F,OAZH;AAaA,SAAKb,KAAL,GAAa9E,IAAb;AACD,GAlBD;;AAoBAoE,EAAAA,UAAU,CAACxD,SAAX,CAAqB6E,MAArB,GAA8B,YAAY;AACxC,SAAKV,KAAL,CAAWa,SAAX;AACA,SAAKd,KAAL,GAAa,IAAb;AACD,GAHD;;AAKAV,EAAAA,UAAU,CAACxD,SAAX,CAAqBiF,OAArB,GAA+B,YAAY,CAAE,CAA7C;;AAEAzB,EAAAA,UAAU,CAACG,IAAX,GAAkB,QAAlB;AACA,SAAOH,UAAP;AACD,CAxCD,CAwCE7E,SAxCF,CAFA;;AA4CA,eAAe6E,UAAf","sourcesContent":["\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\n\r\n\r\n/**\r\n * AUTO-GENERATED FILE. DO NOT MODIFY.\r\n */\r\n\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\nimport { __extends } from \"tslib\";\r\nimport * as graphic from '../../util/graphic.js';\r\nimport { setStatesStylesFromModel, toggleHoverEmphasis } from '../../util/states.js';\r\nimport ChartView from '../../view/Chart.js';\r\nimport { setLabelLineStyle, getLabelLineStatesModels } from '../../label/labelGuideHelper.js';\r\nimport { setLabelStyle, getLabelStatesModels } from '../../label/labelStyle.js';\r\nimport { saveOldStyle } from '../../animation/basicTrasition.js';\r\nvar opacityAccessPath = ['itemStyle', 'opacity'];\r\n/**\r\n * Piece of pie including Sector, Label, LabelLine\r\n */\r\n\r\nvar FunnelPiece =\r\n/** @class */\r\nfunction (_super) {\r\n  __extends(FunnelPiece, _super);\r\n\r\n  function FunnelPiece(data, idx) {\r\n    var _this = _super.call(this) || this;\r\n\r\n    var polygon = _this;\r\n    var labelLine = new graphic.Polyline();\r\n    var text = new graphic.Text();\r\n    polygon.setTextContent(text);\r\n\r\n    _this.setTextGuideLine(labelLine);\r\n\r\n    _this.updateData(data, idx, true);\r\n\r\n    return _this;\r\n  }\r\n\r\n  FunnelPiece.prototype.updateData = function (data, idx, firstCreate) {\r\n    var polygon = this;\r\n    var seriesModel = data.hostModel;\r\n    var itemModel = data.getItemModel(idx);\r\n    var layout = data.getItemLayout(idx);\r\n    var emphasisModel = itemModel.getModel('emphasis');\r\n    var opacity = itemModel.get(opacityAccessPath);\r\n    opacity = opacity == null ? 1 : opacity;\r\n\r\n    if (!firstCreate) {\r\n      saveOldStyle(polygon);\r\n    } // Update common style\r\n\r\n\r\n    polygon.useStyle(data.getItemVisual(idx, 'style'));\r\n    polygon.style.lineJoin = 'round';\r\n\r\n    if (firstCreate) {\r\n      polygon.setShape({\r\n        points: layout.points\r\n      });\r\n      polygon.style.opacity = 0;\r\n      graphic.initProps(polygon, {\r\n        style: {\r\n          opacity: opacity\r\n        }\r\n      }, seriesModel, idx);\r\n    } else {\r\n      graphic.updateProps(polygon, {\r\n        style: {\r\n          opacity: opacity\r\n        },\r\n        shape: {\r\n          points: layout.points\r\n        }\r\n      }, seriesModel, idx);\r\n    }\r\n\r\n    setStatesStylesFromModel(polygon, itemModel);\r\n\r\n    this._updateLabel(data, idx);\r\n\r\n    toggleHoverEmphasis(this, emphasisModel.get('focus'), emphasisModel.get('blurScope'), emphasisModel.get('disabled'));\r\n  };\r\n\r\n  FunnelPiece.prototype._updateLabel = function (data, idx) {\r\n    var polygon = this;\r\n    var labelLine = this.getTextGuideLine();\r\n    var labelText = polygon.getTextContent();\r\n    var seriesModel = data.hostModel;\r\n    var itemModel = data.getItemModel(idx);\r\n    var layout = data.getItemLayout(idx);\r\n    var labelLayout = layout.label;\r\n    var style = data.getItemVisual(idx, 'style');\r\n    var visualColor = style.fill;\r\n    setLabelStyle( // position will not be used in setLabelStyle\r\n    labelText, getLabelStatesModels(itemModel), {\r\n      labelFetcher: data.hostModel,\r\n      labelDataIndex: idx,\r\n      defaultOpacity: style.opacity,\r\n      defaultText: data.getName(idx)\r\n    }, {\r\n      normal: {\r\n        align: labelLayout.textAlign,\r\n        verticalAlign: labelLayout.verticalAlign\r\n      }\r\n    });\r\n    polygon.setTextConfig({\r\n      local: true,\r\n      inside: !!labelLayout.inside,\r\n      insideStroke: visualColor,\r\n      // insideFill: 'auto',\r\n      outsideFill: visualColor\r\n    });\r\n    var linePoints = labelLayout.linePoints;\r\n    labelLine.setShape({\r\n      points: linePoints\r\n    });\r\n    polygon.textGuideLineConfig = {\r\n      anchor: linePoints ? new graphic.Point(linePoints[0][0], linePoints[0][1]) : null\r\n    }; // Make sure update style on labelText after setLabelStyle.\r\n    // Because setLabelStyle will replace a new style on it.\r\n\r\n    graphic.updateProps(labelText, {\r\n      style: {\r\n        x: labelLayout.x,\r\n        y: labelLayout.y\r\n      }\r\n    }, seriesModel, idx);\r\n    labelText.attr({\r\n      rotation: labelLayout.rotation,\r\n      originX: labelLayout.x,\r\n      originY: labelLayout.y,\r\n      z2: 10\r\n    });\r\n    setLabelLineStyle(polygon, getLabelLineStatesModels(itemModel), {\r\n      // Default use item visual color\r\n      stroke: visualColor\r\n    });\r\n  };\r\n\r\n  return FunnelPiece;\r\n}(graphic.Polygon);\r\n\r\nvar FunnelView =\r\n/** @class */\r\nfunction (_super) {\r\n  __extends(FunnelView, _super);\r\n\r\n  function FunnelView() {\r\n    var _this = _super !== null && _super.apply(this, arguments) || this;\r\n\r\n    _this.type = FunnelView.type;\r\n    _this.ignoreLabelLineUpdate = true;\r\n    return _this;\r\n  }\r\n\r\n  FunnelView.prototype.render = function (seriesModel, ecModel, api) {\r\n    var data = seriesModel.getData();\r\n    var oldData = this._data;\r\n    var group = this.group;\r\n    data.diff(oldData).add(function (idx) {\r\n      var funnelPiece = new FunnelPiece(data, idx);\r\n      data.setItemGraphicEl(idx, funnelPiece);\r\n      group.add(funnelPiece);\r\n    }).update(function (newIdx, oldIdx) {\r\n      var piece = oldData.getItemGraphicEl(oldIdx);\r\n      piece.updateData(data, newIdx);\r\n      group.add(piece);\r\n      data.setItemGraphicEl(newIdx, piece);\r\n    }).remove(function (idx) {\r\n      var piece = oldData.getItemGraphicEl(idx);\r\n      graphic.removeElementWithFadeOut(piece, seriesModel, idx);\r\n    }).execute();\r\n    this._data = data;\r\n  };\r\n\r\n  FunnelView.prototype.remove = function () {\r\n    this.group.removeAll();\r\n    this._data = null;\r\n  };\r\n\r\n  FunnelView.prototype.dispose = function () {};\r\n\r\n  FunnelView.type = 'funnel';\r\n  return FunnelView;\r\n}(ChartView);\r\n\r\nexport default FunnelView;"]},"metadata":{},"sourceType":"module"}